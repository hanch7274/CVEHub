<!DOCTYPE html>
        <html>
        <head>
            <meta charset="UTF-8">
            <title>CVEHub &#xd504;&#xb85c;&#xc81d;&#xd2b8; &#xae30;&#xc220; &#xbb38;&#xc11c;</title>
            <style>
/* From extension vscode.github */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only],
.vscode-high-contrast:not(.vscode-high-contrast-light) img[src$=\#gh-light-mode-only],
.vscode-high-contrast-light img[src$=\#gh-dark-mode-only] {
	display: none;
}

</style>
            
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item {
    list-style-type: none;
}

.task-list-item-checkbox {
    margin-left: -20px;
    vertical-align: middle;
    pointer-events: none;
}
</style>
<style>
:root {
  --color-note: #0969da;
  --color-tip: #1a7f37;
  --color-warning: #9a6700;
  --color-severe: #bc4c00;
  --color-caution: #d1242f;
  --color-important: #8250df;
}

</style>
<style>
@media (prefers-color-scheme: dark) {
  :root {
    --color-note: #2f81f7;
    --color-tip: #3fb950;
    --color-warning: #d29922;
    --color-severe: #db6d28;
    --color-caution: #f85149;
    --color-important: #a371f7;
  }
}

</style>
<style>
.markdown-alert {
  padding: 0.5rem 1rem;
  margin-bottom: 16px;
  color: inherit;
  border-left: .25em solid #888;
}

.markdown-alert>:first-child {
  margin-top: 0
}

.markdown-alert>:last-child {
  margin-bottom: 0
}

.markdown-alert .markdown-alert-title {
  display: flex;
  font-weight: 500;
  align-items: center;
  line-height: 1
}

.markdown-alert .markdown-alert-title .octicon {
  margin-right: 0.5rem;
  display: inline-block;
  overflow: visible !important;
  vertical-align: text-bottom;
  fill: currentColor;
}

.markdown-alert.markdown-alert-note {
  border-left-color: var(--color-note);
}

.markdown-alert.markdown-alert-note .markdown-alert-title {
  color: var(--color-note);
}

.markdown-alert.markdown-alert-important {
  border-left-color: var(--color-important);
}

.markdown-alert.markdown-alert-important .markdown-alert-title {
  color: var(--color-important);
}

.markdown-alert.markdown-alert-warning {
  border-left-color: var(--color-warning);
}

.markdown-alert.markdown-alert-warning .markdown-alert-title {
  color: var(--color-warning);
}

.markdown-alert.markdown-alert-tip {
  border-left-color: var(--color-tip);
}

.markdown-alert.markdown-alert-tip .markdown-alert-title {
  color: var(--color-tip);
}

.markdown-alert.markdown-alert-caution {
  border-left-color: var(--color-caution);
}

.markdown-alert.markdown-alert-caution .markdown-alert-title {
  color: var(--color-caution);
}

</style>
        
        </head>
        <body class="vscode-body vscode-light">
            <h1 id="cvehub-프로젝트-기술-문서">CVEHub 프로젝트 기술 문서</h1>
<h2 id="1-개요-overview">1. 개요 (Overview)</h2>
<p><strong>프로젝트명:</strong> CVEHub</p>
<p><strong>목적:</strong> CVE(Common Vulnerabilities and Exposures) 정보를 효율적으로 관리, 추적, 공유하고 관련 데이터를 자동 수집하는 통합 웹 플랫폼입니다. 사용자는 CVE 검색, 상세 정보 확인, 신규 등록, 상태/심각도 업데이트, 댓글/PoC/Snort Rule/참조 정보 추가, 활동 이력 추적 등의 기능을 수행할 수 있습니다. 실시간 업데이트와 협업 기능을 통해 보안 취약점 관리를 지원합니다.</p>
<p><strong>주요 기능:</strong></p>
<ul>
<li><strong>CVE 관리:</strong> 목록 조회, 상세 보기, 생성, 수정(필드 단위 업데이트 포함), 삭제</li>
<li><strong>데이터 수집:</strong> 자동화된 크롤러(Nuclei, Metasploit, EmergingThreats)를 통한 관련 정보(PoC, Snort Rules) 수집 및 업데이트</li>
<li><strong>협업 및 정보 공유:</strong> CVE별 댓글 기능 (멘션 포함), 참조 링크, PoC 정보 공유</li>
<li><strong>실시간 동기화:</strong> WebSocket(<a href="http://Socket.IO">Socket.IO</a>)을 통한 데이터 변경 사항 실시간 전파 (CVE 업데이트, 댓글, 알림 등)</li>
<li><strong>사용자 관리 및 인증:</strong> JWT 기반 사용자 인증, 역할 기반 접근 제어(관리자 기능), 사용자 정보 관리</li>
<li><strong>활동 이력:</strong> 사용자 및 시스템 활동 로그 추적 및 조회</li>
<li><strong>알림:</strong> 사용자 멘션, CVE 업데이트 등 주요 이벤트에 대한 실시간 알림</li>
<li><strong>캐시 관리:</strong> Redis 캐시 및 React Query 캐시 상태 시각화 및 관리 기능 (관리자용)</li>
</ul>
<p><strong>기술 스택:</strong></p>
<ul>
<li><strong>프론트엔드:</strong> React.js (v18+), Material UI (MUI), React Query (@tanstack/react-query), Zustand, React Router, Axios, <a href="http://Socket.IO">Socket.IO</a> Client, TypeScript, date-fns, Notistack, Helmet-async</li>
<li><strong>백엔드:</strong> Python (v3.9+), FastAPI, Beanie (MongoDB ODM), Motor (Async MongoDB Driver), Pydantic, python-socketio, APScheduler, Passlib (비밀번호 해싱), python-jose (JWT), Redis (aioredis/redis.asyncio), GitPython, PyYAML, Aiohttp</li>
<li><strong>데이터베이스:</strong> MongoDB</li>
<li><strong>캐싱:</strong> Redis</li>
<li><strong>번들링:</strong> Webpack</li>
<li><strong>기타:</strong> <code>humps</code> (케이스 변환), <code>lodash</code></li>
</ul>
<h2 id="2-시스템-아키텍처-system-architecture">2. 시스템 아키텍처 (System Architecture)</h2>
<p>CVEHub는 모놀리식 백엔드와 싱글 페이지 애플리케이션(SPA) 프론트엔드로 구성된 웹 서비스입니다.</p>
<pre><code class="language-mermaid">graph LR
    subgraph &quot;사용자 브라우저&quot;
        A[프론트엔드 (React)]
    end

    subgraph &quot;서버 인프라&quot;
        B[웹 서버 (FastAPI)]
        C[데이터베이스 (MongoDB)]
        D[캐시 (Redis)]
        E[WebSocket 서버 (Socket.IO)]
        F[스케줄러 (APScheduler)]
        G[크롤러 프로세스]
    end

    A -- HTTP API 요청 --&gt; B
    B -- 데이터 조회/수정 --&gt; C
    B -- 캐시 조회/저장 --&gt; D
    A -- WebSocket 연결 --&gt; E
    E -- 실시간 이벤트 --&gt; A
    B -- WebSocket 이벤트 발행 --&gt; E
    F -- 크롤링 작업 예약/실행 --&gt; G
    G -- 데이터 저장 --&gt; B
    B -- 크롤러 상태 업데이트 --&gt; E
</code></pre>
<ul>
<li><strong>사용자 인터페이스 (프론트엔드):</strong> React 기반 SPA로 사용자 상호작용 처리 및 데이터 시각화.</li>
<li><strong>API 서버 (백엔드):</strong> FastAPI 기반 RESTful API 제공. 인증, CRUD 작업, 비즈니스 로직 처리.</li>
<li><strong>데이터 저장소 (MongoDB):</strong> Beanie ODM을 통해 상호작용하며 애플리케이션 데이터 영구 저장.</li>
<li><strong>캐싱 (Redis):</strong> API 응답 및 자주 사용되는 데이터 캐싱으로 성능 향상.</li>
<li><strong>실시간 통신 (WebSocket):</strong> Socket.IO를 통해 클라이언트-서버 간 양방향 실시간 통신. 데이터 변경 알림, 구독 관리 등에 사용.</li>
<li><strong>백그라운드 작업 (APScheduler/Crawler):</strong> 정기적으로 외부 소스(Nuclei, Metasploit 등)에서 데이터를 크롤링하여 DB 업데이트.</li>
</ul>
<h2 id="3-프론트엔드-상세-분석-frontend-details">3. 프론트엔드 상세 분석 (Frontend Details)</h2>
<h3 id="31-구조-src">3.1. 구조 (<code>src/</code>)</h3>
<ul>
<li><strong><code>App.jsx</code>:</strong> 최상위 컴포넌트. 라우팅, 전역 컨텍스트 설정, <a href="http://Socket.IO">Socket.IO</a> 연결 관리, 전역 에러 핸들링 초기화.</li>
<li><strong><code>core/socket/</code>:</strong> <a href="http://Socket.IO">Socket.IO</a> 클라이언트 로직 집중.
<ul>
<li><code>socketService.ts</code>: 소켓 연결 관리, 이벤트 송수신, 상태 동기화 싱글톤 서비스.</li>
<li><code>socketStore.ts</code>: Zustand 기반 소켓 상태(연결, 오류 등) 전역 관리.</li>
<li><code>useSocket.ts</code>: 컴포넌트에서 소켓 기능 사용을 위한 커스텀 훅.</li>
<li><code>WebSocketQueryBridge.tsx</code>: 소켓 이벤트를 감지하여 React Query 캐시 자동 업데이트.</li>
</ul>
</li>
<li><strong><code>features/</code>:</strong> 기능별 모듈 분리 (auth, cve, notification, cache, activities). 각 모듈은 컴포넌트, 훅(쿼리, 뮤테이션, 소켓), 서비스, 타입 정의 포함.</li>
<li><strong><code>shared/</code>:</strong> 모듈 간 공유되는 코드 (API 설정, 공통 타입, 유틸리티, 공유 컨텍스트).</li>
<li><strong><code>layout/</code>:</strong> Header, Sidebar 등 레이아웃 컴포넌트.</li>
</ul>
<h3 id="32-주요-컴포넌트-및-로직">3.2. 주요 컴포넌트 및 로직</h3>
<ul>
<li><strong><code>App.jsx</code>:</strong>
<ul>
<li><strong>라우팅:</strong> <code>/</code>, <code>/login</code>, <code>/signup</code>, <code>/cves</code>, <code>/cves/:cveId</code>, <code>/create-cve</code>, <code>/cache</code>, <code>/activities</code> 경로 정의. <code>PrivateRoute</code>, <code>AuthRoute</code>로 접근 제어.</li>
<li><strong>소켓 관리:</strong> <code>useEffect</code>를 활용하여 인증 상태, 페이지 경로, 네트워크 상태, 브라우저 가시성에 따라 <code>socketService</code>의 <code>connect</code>/<code>disconnect</code>/<code>handleAuthStateChange</code> 호출하며 <strong>동적으로 소켓 연결 관리</strong>.</li>
<li><strong>전역 설정:</strong> <code>QueryClientProvider</code>, <code>AuthProvider</code>, <code>ErrorProvider</code> 등 설정.</li>
<li><strong>Lazy Loading:</strong> <code>CVEDetail</code>, <code>CacheVisualization</code>, <code>ActivitiesPage</code> 지연 로딩.</li>
</ul>
</li>
<li><strong><code>CVEList.jsx</code>:</strong>
<ul>
<li><code>useCVEList</code>, <code>useTotalCVECount</code>, <code>useCVEStats</code> 훅으로 데이터 조회.</li>
<li>필터링(검색, 상태, 심각도), 정렬, 페이지네이션 기능 구현. <code>useState</code>로 필터 상태 관리.</li>
<li><code>useCVEListUpdates</code> 훅으로 실시간 목록 업데이트 구독.</li>
<li>테이블(<code>CVETable</code>), 통계 섹션(<code>StatisticsSection</code>), 필터 바(<code>FilterBar</code>), 스켈레톤 UI(<code>CVETableSkeleton</code>), 에러/빈 상태 표시 컴포넌트 포함.</li>
<li>CVE 항목 클릭 시 <code>CVEDetail</code> 모달 표시.</li>
<li>CVE 생성(<code>CreateCVE</code>) 및 삭제 기능 연동.</li>
</ul>
</li>
<li><strong><code>CVEDetail.tsx</code>:</strong>
<ul>
<li>모달 형태 UI (<code>Dialog</code>).</li>
<li><code>useCVEDetail</code>, <code>useCVESubscription</code>, <code>useCVERefresh</code>, <code>useUpdateCVEField</code> 훅 사용.</li>
<li><strong>실시간 구독:</strong> 모달 열릴 때 <code>subscribe()</code>, 닫힐 때 <code>unsubscribe()</code> 호출하여 해당 CVE 정보 실시간 구독/해제 (<code>useCVESubscription</code>). 구독자 정보 표시 (<code>SubscriberCount</code>).</li>
<li><strong>실시간 업데이트 처리:</strong> <code>useSocket</code>의 <code>on('cve_updated')</code> 핸들러(<code>handleWebSocketUpdate</code>)에서 수신 데이터를 React Query 캐시에 직접 반영(<code>queryClient.setQueryData</code>)하거나 무효화(<code>invalidateQueries</code>). <code>lastProcessedUpdateIdRef</code>로 중복 업데이트 방지.</li>
<li><strong>정보 표시 및 편집:</strong> 헤더(<code>CVEDetailHeader</code>), 기본 정보 패널(<code>CVEDetailInfoPanel</code> - InlineEditText 사용), 탭(<code>CVEDetailTabs</code>)으로 구성.</li>
<li><strong>탭 관리:</strong> <code>CVEDetailTabs</code>에서 각 탭(PoC, Snort, References, Comments, History) 컴포넌트 렌더링. <code>GenericDataTab</code>을 재사용하여 PoC, Snort, References 구현. 탭별 데이터 개수(<code>tabCounts</code>) 관리 및 표시.</li>
</ul>
</li>
<li><strong><code>GenericDataTab.tsx</code>:</strong>
<ul>
<li>PoC, Snort Rules, References 탭의 공통 로직 구현 (목록 표시, 추가/수정/삭제 다이얼로그).</li>
<li><code>tabConfig</code> prop을 통해 각 탭의 특성(아이콘, 필드명, 유효성 검사 등) 주입받음.</li>
<li><code>useUpdateCVEField</code> 훅을 사용하여 데이터 변경 사항 백엔드에 저장.</li>
</ul>
</li>
<li><strong><code>CommentsTab.tsx</code>:</strong>
<ul>
<li>댓글 목록 표시 (계층 구조), 새 댓글/답글 작성, 수정, 삭제 기능.</li>
<li><code>useCommentMutations</code> 훅 사용.</li>
<li><code>MentionInput</code> 컴포넌트로 사용자 멘션 기능 구현 (<code>useSearchUsers</code> 훅으로 사용자 목록 조회).</li>
<li><strong>실시간 댓글 업데이트:</strong> <code>useSocket</code>의 <code>on</code> 메서드로 <code>COMMENT_ADDED</code>, <code>COMMENT_UPDATED</code>, <code>COMMENT_DELETED</code> 이벤트 구독 및 캐시 업데이트.</li>
</ul>
</li>
</ul>
<h3 id="33-상태-관리-및-데이터-흐름">3.3. 상태 관리 및 데이터 흐름</h3>
<ul>
<li><strong>서버 데이터:</strong> React Query가 API 호출 결과 캐싱 및 관리. 소켓 이벤트를 통해 캐시가 업데이트되면 UI 자동 갱신.</li>
<li><strong>소켓 상태:</strong> Zustand 스토어(<code>socketStore</code>)에 연결 상태, 오류 등 저장. <code>useSocket</code> 훅이 이 스토어 상태 반영.</li>
<li><strong>인증 상태:</strong> <code>AuthContext</code> 통해 전역 관리. 로그인/로그아웃 시 상태 변경 및 관련 캐시/소켓 연결 처리.</li>
<li><strong>로컬 UI 상태:</strong> <code>useState</code> 주로 사용 (모달 열림, 입력 값 등).</li>
<li><strong>데이터 흐름 (댓글 작성 예시):</strong>
<ol>
<li><code>CommentsTab</code>: 사용자가 <code>MentionInput</code>에 댓글 입력 및 제출.</li>
<li><code>CommentsTab</code>: <code>handleSubmit</code> -&gt; <code>useCommentMutations.createComment</code> 호출.</li>
<li><code>useCommentMutations</code>: React Query <code>useMutation</code> 실행 -&gt; <code>api.post('/cves/{cve_id}/comments', ...)</code> 호출 (Axios).</li>
<li><code>(Optimistic Update)</code>: <code>onMutate</code>에서 캐시에 임시 댓글 추가.</li>
<li><strong>백엔드:</strong> 댓글 생성 -&gt; DB 저장 -&gt; 업데이트된 CVE 데이터 반환.</li>
<li><code>useCommentMutations</code>: <code>onSuccess</code> -&gt; <code>queryClient.setQueryData</code>로 캐시 업데이트, <code>parentSendMessage(SOCKET_EVENTS.COMMENT_ADDED)</code> 호출하여 소켓 이벤트 전송 요청.</li>
<li><strong>백엔드 (<a href="http://Socket.IO">Socket.IO</a>):</strong> <code>COMMENT_ADDED</code> 이벤트 수신 및 브로드캐스트.</li>
<li>다른 클라이언트: <code>CommentsTab</code>의 <code>useEffect</code> 내 <code>on(SOCKET_EVENTS.COMMENT_ADDED)</code> 핸들러 -&gt; 캐시 업데이트 -&gt; UI 갱신.</li>
</ol>
</li>
</ul>
<h2 id="4-백엔드-상세-분석-backend-details">4. 백엔드 상세 분석 (Backend Details)</h2>
<h3 id="41-구조-app">4.1. 구조 (<code>app/</code>)</h3>
<ul>
<li><strong><code>main.py</code>:</strong> FastAPI 앱 인스턴스 생성, 미들웨어(CORS, 로깅), 전역 예외 핸들러, API 라우터 등록, DB 및 <a href="http://Socket.IO">Socket.IO</a> 초기화 (<code>startup_event</code>).</li>
<li><strong><code>api.py</code>:</strong> 각 기능별 라우터(<code>auth</code>, <code>cve</code>, <code>comment</code> 등)를 통합하여 <code>/api/v1</code> (예상) 경로 아래에 마운트.</li>
<li><strong><code>core/</code>:</strong> 핵심 모듈.
<ul>
<li><code>config.py</code>: <code>Settings</code> 클래스 (환경 변수 로드).</li>
<li><code>dependencies.py</code>: 서비스, 리포지토리 등 의존성 주입 함수 (<code>Depends</code>, <code>lru_cache</code>).</li>
<li><code>cache.py</code>: Redis 캐싱 유틸리티.</li>
<li><code>scheduler.py</code>: <code>APScheduler</code> 기반 크롤러 스케줄링.</li>
<li><code>exceptions.py</code>, <code>error_handlers.py</code>: 커스텀 예외 및 처리 로직.</li>
<li><code>security.py</code>: 비밀번호 해싱.</li>
</ul>
</li>
<li><strong><code>common/</code>:</strong> 공통 모듈.
<ul>
<li><code>models/base_models.py</code>: Pydantic <code>BaseSchema</code>, Beanie <code>BaseDocument</code> 등 기본 모델.</li>
<li><code>repositories/base.py</code>: <code>BaseRepository</code> (기본 CRUD).</li>
<li><code>utils/</code>: 날짜, 변경 감지 등 공통 유틸리티.</li>
</ul>
</li>
<li><strong><code>features/</code> (추정, 현재 구조는 <code>app/</code> 하위에 직접 배치):</strong> 각 기능별 모듈 (모델, 리포지토리, 서비스, 라우터).</li>
</ul>
<h3 id="42-주요-모듈-및-로직">4.2. 주요 모듈 및 로직</h3>
<ul>
<li><strong>인증 (<code>auth/</code>):</strong>
<ul>
<li><strong>핵심:</strong> <code>UserService</code> (<code>service.py</code>). 사용자 생성/조회/수정/삭제, 비밀번호 검증/해싱, JWT 액세스/리프레시 토큰 생성/검증/무효화 로직.</li>
<li><strong>DB:</strong> <code>User</code>, <code>RefreshToken</code> 모델 (<code>models.py</code>).</li>
<li><strong>API:</strong> <code>/token</code>(로그인), <code>/refresh</code>, <code>/logout</code>, <code>/signup</code>, <code>/me</code>, <code>/search</code>, <code>/</code> (사용자 목록) 엔드포인트 제공 (<code>router.py</code>). <code>oauth2_scheme</code> 및 <code>get_current_user</code> 의존성으로 토큰 기반 인증 수행.</li>
</ul>
</li>
<li><strong>CVE 관리 (<code>cve/</code>):</strong>
<ul>
<li><strong>핵심:</strong> <code>CVEService</code> (<code>service.py</code>). CVE CRUD 로직, 캐싱 처리 호출, <strong>활동 로그 기록</strong> (<code>ActivityService</code>, <code>track_cve_activity</code> 데코레이터 사용), 댓글/알림 서비스 연동.</li>
<li><strong>DB:</strong> <code>CVEModel</code> (댓글 등 임베디드), <code>Reference</code>, <code>PoC</code>, <code>SnortRule</code>, <code>ModificationHistory</code> 등 (<code>models.py</code>).</li>
<li><strong>리포지토리:</strong> <code>CVERepository</code> (<code>repository.py</code>). MongoDB 작업 캡슐화.</li>
<li><strong>API:</strong> <code>/cves/list</code>, <code>/cves/total-count</code>, <code>/cves/stats</code>, <code>/cves/{cve_id}</code> (GET, PATCH, DELETE) 엔드포인트 제공 (<code>router.py</code>).</li>
</ul>
</li>
<li><strong>댓글 (<code>comment/</code>):</strong>
<ul>
<li><strong>핵심:</strong> <code>CommentService</code> (<code>service.py</code>). 댓글 생성/수정/삭제 로직. <strong>멘션 처리</strong> (<code>process_mentions</code>) 및 알림 생성 로직 포함. 활동 로그 기록.</li>
<li><strong>DB:</strong> <code>Comment</code> 모델 (실제 저장은 CVE 문서 내).</li>
<li><strong>리포지토리:</strong> <code>CommentRepository</code> (<code>repository.py</code>). CVE 문서 내 <code>comments</code> 배열 조작.</li>
<li><strong>API:</strong> <code>/cves/{cve_id}/comments</code> (POST, GET), <code>/cves/{cve_id}/comments/{comment_id}</code> (PUT, DELETE), <code>/cves/{cve_id}/comments/count</code> 엔드포인트 제공 (<code>router.py</code>).</li>
</ul>
</li>
<li><strong><a href="http://Socket.IO">Socket.IO</a> (<code>socketio/</code>):</strong>
<ul>
<li><strong>핵심:</strong> <code>SocketManager</code> (<code>manager.py</code>). <a href="http://Socket.IO">Socket.IO</a> 서버 설정, 이벤트 핸들러 등록 (<code>connect</code>, <code>disconnect</code>, <code>subscribe_cve</code>, <code>unsubscribe_cve</code>), 메시지 발송 유틸리티. <code>UserService</code>를 이용한 연결 시 <strong>토큰 인증</strong>.</li>
<li><strong>상태 관리:</strong> <code>SocketRepository</code> (<code>repository.py</code>). <strong>메모리 기반</strong>으로 실시간 연결(SID), 사용자, 세션, CVE 구독 정보 관리.</li>
<li><strong>비즈니스 로직:</strong> <code>SocketService</code> (<code>service.py</code>). 구독/해제 로직, 알림 생성/전송 연동.</li>
<li><strong>API:</strong> HTTP 엔드포인트 제공 (<code>router.py</code>) - 구독 정리, 상태 조회.</li>
<li><strong>이벤트:</strong> <code>WSMessageType</code> Enum (<code>models.py</code>)으로 이벤트 이름 표준화. 주요 이벤트: <code>CONNECT_ACK</code>, <code>NOTIFICATION</code>, <code>CVE_UPDATED</code>, <code>COMMENT_ADDED</code>, <code>SUBSCRIPTION_STATUS</code>, <code>CVE_SUBSCRIBERS_UPDATED</code>, <code>CACHE_INVALIDATED</code> 등.</li>
</ul>
</li>
<li><strong>크롤러 (<code>crawler/</code>, <code>core/scheduler.py</code>):</strong>
<ul>
<li><strong>구조:</strong> <code>BaseCrawlerService</code> -&gt; 개별 크롤러 (<code>nuclei_crawler</code>, <code>metasploit_crawler</code>, <code>emerging_threats_crawler</code>) -&gt; <code>CrawlerManager</code> -&gt; <code>CrawlerService</code> -&gt; <code>CrawlerScheduler</code>.</li>
<li><strong>로직:</strong> 각 크롤러는 <code>fetch_data</code>, <code>parse_data</code>, <code>process_data</code> 구현. <code>CVEService</code>를 통해 DB 업데이트. <code>report_progress</code>로 진행 상황 보고 (WebSocket).</li>
<li><strong>스케줄링:</strong> <code>APScheduler</code>가 <code>CrawlerScheduler</code>를 통해 정기적으로 크롤러 실행 (<code>_run_crawler_task</code>). <code>SystemConfig</code> DB 모델로 마지막 실행 시간 관리.</li>
<li><strong>API:</strong> 수동 실행, 상태 조회 등 (<code>router.py</code>).</li>
</ul>
</li>
<li><strong>활동 이력 (<code>activity/</code>):</strong>
<ul>
<li><strong>핵심:</strong> <code>ActivityService</code> (<code>service.py</code>). 활동 기록 생성(<code>create_activity</code>). 객체 변경 감지 유틸리티(<code>detect_object_changes</code>) 사용하여 자동 로그 생성(<code>track_object_changes</code>).</li>
<li><strong>DB:</strong> <code>UserActivity</code> 모델 (<code>models.py</code>).</li>
<li><strong>리포지토리:</strong> <code>ActivityRepository</code> (<code>repository.py</code>).</li>
<li><strong>API:</strong> 활동 목록 조회 (내 활동, 사용자별, 대상별, 전체) (<code>router.py</code>).</li>
</ul>
</li>
</ul>
<h3 id="43-데이터베이스-및-캐싱">4.3. 데이터베이스 및 캐싱</h3>
<ul>
<li><strong>MongoDB:</strong> Beanie ODM을 통해 비동기적으로 상호작용. CVE 문서에 관련 정보 임베딩. 인덱스를 활용한 조회 성능 최적화.</li>
<li><strong>Redis:</strong> <code>core/cache.py</code>를 통해 캐싱 기능 제공. 주로 CVE 상세 정보 및 목록 캐싱에 사용. 캐시 키 프리픽스 및 TTL 관리. <code>invalidate_cve_caches</code> 함수로 업데이트 시 캐시 무효화 및 WebSocket 알림.</li>
</ul>
<h2 id="5-api-및-websocket-명세-요약">5. API 및 WebSocket 명세 (요약)</h2>
<h3 id="51-주요-rest-api-엔드포인트">5.1. 주요 REST API 엔드포인트</h3>
<table>
<thead>
<tr>
<th style="text-align:left">경로</th>
<th style="text-align:left">메소드</th>
<th style="text-align:left">설명</th>
<th style="text-align:left">인증</th>
<th style="text-align:left">주요 요청/응답 모델</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>/auth/token</code></td>
<td style="text-align:left">POST</td>
<td style="text-align:left">로그인 (토큰 발급)</td>
<td style="text-align:left">없음</td>
<td style="text-align:left">OAuth2PasswordRequestForm / Token</td>
</tr>
<tr>
<td style="text-align:left"><code>/auth/refresh</code></td>
<td style="text-align:left">POST</td>
<td style="text-align:left">토큰 갱신</td>
<td style="text-align:left">없음</td>
<td style="text-align:left">RefreshTokenRequest / Token</td>
</tr>
<tr>
<td style="text-align:left"><code>/auth/logout</code></td>
<td style="text-align:left">POST</td>
<td style="text-align:left">로그아웃 (토큰 무효화)</td>
<td style="text-align:left">없음</td>
<td style="text-align:left">LogoutRequest / {message}</td>
</tr>
<tr>
<td style="text-align:left"><code>/auth/signup</code></td>
<td style="text-align:left">POST</td>
<td style="text-align:left">회원가입</td>
<td style="text-align:left">없음</td>
<td style="text-align:left">UserCreate / Token</td>
</tr>
<tr>
<td style="text-align:left"><code>/auth/me</code></td>
<td style="text-align:left">GET</td>
<td style="text-align:left">내 정보 조회</td>
<td style="text-align:left">필요</td>
<td style="text-align:left">- / UserResponse</td>
</tr>
<tr>
<td style="text-align:left"><code>/auth/me</code></td>
<td style="text-align:left">PATCH</td>
<td style="text-align:left">내 정보 수정</td>
<td style="text-align:left">필요</td>
<td style="text-align:left">UserUpdate / UserResponse</td>
</tr>
<tr>
<td style="text-align:left"><code>/auth/me</code></td>
<td style="text-align:left">DELETE</td>
<td style="text-align:left">내 계정 삭제</td>
<td style="text-align:left">필요</td>
<td style="text-align:left">- / {message}</td>
</tr>
<tr>
<td style="text-align:left"><code>/auth/search</code></td>
<td style="text-align:left">GET</td>
<td style="text-align:left">사용자 검색 (멘션용)</td>
<td style="text-align:left">필요</td>
<td style="text-align:left">?query= / List[dict]</td>
</tr>
<tr>
<td style="text-align:left"><code>/cves/list</code></td>
<td style="text-align:left">GET</td>
<td style="text-align:left">CVE 목록 조회</td>
<td style="text-align:left">필요</td>
<td style="text-align:left">?page=&amp;limit=&amp;... / CVEListResponse</td>
</tr>
<tr>
<td style="text-align:left"><code>/cves/total-count</code></td>
<td style="text-align:left">GET</td>
<td style="text-align:left">전체 CVE 개수 조회</td>
<td style="text-align:left">필요</td>
<td style="text-align:left">- / {count}</td>
</tr>
<tr>
<td style="text-align:left"><code>/cves/stats</code></td>
<td style="text-align:left">GET</td>
<td style="text-align:left">CVE 통계 조회</td>
<td style="text-align:left">필요</td>
<td style="text-align:left">- / Dict[str, int]</td>
</tr>
<tr>
<td style="text-align:left"><code>/cves/{cve_id}</code></td>
<td style="text-align:left">GET</td>
<td style="text-align:left">CVE 상세 조회</td>
<td style="text-align:left">필요</td>
<td style="text-align:left">- / CVEDetailResponse</td>
</tr>
<tr>
<td style="text-align:left"><code>/cves</code></td>
<td style="text-align:left">POST</td>
<td style="text-align:left">CVE 생성</td>
<td style="text-align:left">필요</td>
<td style="text-align:left">CreateCVERequest / CVEDetailResponse</td>
</tr>
<tr>
<td style="text-align:left"><code>/cves/{cve_id}</code></td>
<td style="text-align:left">PATCH</td>
<td style="text-align:left">CVE 수정</td>
<td style="text-align:left">필요</td>
<td style="text-align:left">PatchCVERequest / CVEDetailResponse</td>
</tr>
<tr>
<td style="text-align:left"><code>/cves/{cve_id}</code></td>
<td style="text-align:left">DELETE</td>
<td style="text-align:left">CVE 삭제 (관리자)</td>
<td style="text-align:left">관리자</td>
<td style="text-align:left">- / CVEOperationResponse</td>
</tr>
<tr>
<td style="text-align:left"><code>/cves/{cve_id}/comments</code></td>
<td style="text-align:left">POST</td>
<td style="text-align:left">댓글 생성</td>
<td style="text-align:left">필요</td>
<td style="text-align:left">CommentCreate / CommentResponse</td>
</tr>
<tr>
<td style="text-align:left"><code>/cves/{cve_id}/comments</code></td>
<td style="text-align:left">GET</td>
<td style="text-align:left">댓글 목록 조회</td>
<td style="text-align:left">필요</td>
<td style="text-align:left">- / List[CommentResponse]</td>
</tr>
<tr>
<td style="text-align:left"><code>/cves/{cve_id}/comments/{comment_id}</code></td>
<td style="text-align:left">PUT</td>
<td style="text-align:left">댓글 수정</td>
<td style="text-align:left">필요</td>
<td style="text-align:left">CommentUpdate / CommentResponse</td>
</tr>
<tr>
<td style="text-align:left"><code>/cves/{cve_id}/comments/{comment_id}</code></td>
<td style="text-align:left">DELETE</td>
<td style="text-align:left">댓글 삭제</td>
<td style="text-align:left">필요</td>
<td style="text-align:left">?permanent= / {message}</td>
</tr>
<tr>
<td style="text-align:left"><code>/notifications</code></td>
<td style="text-align:left">GET</td>
<td style="text-align:left">알림 목록 조회</td>
<td style="text-align:left">필요</td>
<td style="text-align:left">?skip=&amp;limit=&amp;... / PaginatedResponse[Notification]</td>
</tr>
<tr>
<td style="text-align:left"><code>/notifications/unread/count</code></td>
<td style="text-align:left">GET</td>
<td style="text-align:left">읽지 않은 알림 수 조회</td>
<td style="text-align:left">필요</td>
<td style="text-align:left">- / {count}</td>
</tr>
<tr>
<td style="text-align:left"><code>/notifications/{id}/read</code></td>
<td style="text-align:left">PATCH</td>
<td style="text-align:left">알림 읽음 처리</td>
<td style="text-align:left">필요</td>
<td style="text-align:left">- / Notification</td>
</tr>
<tr>
<td style="text-align:left"><code>/notifications/mark-all-read</code></td>
<td style="text-align:left">PATCH</td>
<td style="text-align:left">모든 알림 읽음 처리</td>
<td style="text-align:left">필요</td>
<td style="text-align:left">- / {count}</td>
</tr>
<tr>
<td style="text-align:left"><code>/crawler/run/{type}</code></td>
<td style="text-align:left">POST</td>
<td style="text-align:left">크롤러 실행 (관리자)</td>
<td style="text-align:left">관리자</td>
<td style="text-align:left">- / CrawlerResponse</td>
</tr>
<tr>
<td style="text-align:left"><code>/crawler/status</code></td>
<td style="text-align:left">GET</td>
<td style="text-align:left">크롤러 상태 조회</td>
<td style="text-align:left">필요</td>
<td style="text-align:left">- / CrawlerStatusResponse</td>
</tr>
<tr>
<td style="text-align:left"><code>/cache/info</code></td>
<td style="text-align:left">GET</td>
<td style="text-align:left">Redis 정보 조회</td>
<td style="text-align:left">관리자</td>
<td style="text-align:left">- / Dict</td>
</tr>
<tr>
<td style="text-align:left"><code>/cache/stats</code></td>
<td style="text-align:left">GET</td>
<td style="text-align:left">Redis 통계 조회</td>
<td style="text-align:left">관리자</td>
<td style="text-align:left">- / Dict</td>
</tr>
<tr>
<td style="text-align:left"><code>/cache/keys</code></td>
<td style="text-align:left">GET</td>
<td style="text-align:left">Redis 키 목록 조회</td>
<td style="text-align:left">관리자</td>
<td style="text-align:left">?prefix=&amp;pattern= / {keys}</td>
</tr>
<tr>
<td style="text-align:left"><code>/cache/values</code></td>
<td style="text-align:left">GET</td>
<td style="text-align:left">Redis 값 조회</td>
<td style="text-align:left">관리자</td>
<td style="text-align:left">?prefix=&amp;pattern= / {values}</td>
</tr>
<tr>
<td style="text-align:left"><code>/cache/clear</code></td>
<td style="text-align:left">DELETE</td>
<td style="text-align:left">Redis 캐시 삭제</td>
<td style="text-align:left">관리자</td>
<td style="text-align:left">?prefix=&amp;pattern= / {deleted}</td>
</tr>
<tr>
<td style="text-align:left"><code>/activities</code></td>
<td style="text-align:left">GET</td>
<td style="text-align:left">활동 목록 조회 (필터링)</td>
<td style="text-align:left">필요</td>
<td style="text-align:left">?username=&amp;... / ActivityListResponse</td>
</tr>
<tr>
<td style="text-align:left"><code>/activities/me</code></td>
<td style="text-align:left">GET</td>
<td style="text-align:left">내 활동 목록 조회</td>
<td style="text-align:left">필요</td>
<td style="text-align:left">?page=&amp;limit= / ActivityListResponse</td>
</tr>
<tr>
<td style="text-align:left"><code>/activities/users/{username}</code></td>
<td style="text-align:left">GET</td>
<td style="text-align:left">특정 사용자 활동 조회</td>
<td style="text-align:left">필요</td>
<td style="text-align:left">?page=&amp;limit= / ActivityListResponse</td>
</tr>
<tr>
<td style="text-align:left"><code>/activities/targets/{type}/{id}</code></td>
<td style="text-align:left">GET</td>
<td style="text-align:left">특정 대상 활동 조회</td>
<td style="text-align:left">필요</td>
<td style="text-align:left">?page=&amp;limit= / ActivityListResponse</td>
</tr>
</tbody>
</table>
<h3 id="52-주요-websocket-이벤트-server---client">5.2. 주요 WebSocket 이벤트 (Server -&gt; Client)</h3>
<ul>
<li><strong><code>CONNECT_ACK</code>:</strong> 인증 성공 및 세션 정보 전달</li>
<li><strong><code>CONNECTED</code>:</strong> 인증 미포함 연결 성공 알림 (일반적으론 사용되지 않음)</li>
<li><strong><code>NOTIFICATION</code>:</strong> 새 알림 발생 알림 (알림 내용, 읽지 않은 수 포함)</li>
<li><strong><code>CVE_CREATED</code>, <code>CVE_UPDATED</code>, <code>CVE_DELETED</code>:</strong> CVE 변경 알림 (업데이트된 CVE 데이터 또는 ID 포함)</li>
<li><strong><code>COMMENT_ADDED</code>, <code>COMMENT_UPDATED</code>, <code>COMMENT_DELETED</code>:</strong> 댓글 변경 알림 (업데이트된 댓글 데이터 또는 ID, 관련 CVE 데이터 포함)</li>
<li><strong><code>COMMENT_COUNT_UPDATE</code>:</strong> 특정 CVE의 댓글 수 업데이트 알림</li>
<li><strong><code>SUBSCRIPTION_STATUS</code>:</strong> CVE 구독/해제 결과 알림 (성공 여부, 구독자 수 등 포함)</li>
<li><strong><code>CVE_SUBSCRIBERS_UPDATED</code>:</strong> 특정 CVE의 구독자 목록 변경 알림 (구독자 목록 포함)</li>
<li><strong><code>CRAWLER_UPDATE_PROGRESS</code>:</strong> 크롤러 진행 상황 알림 (단계, 진행률, 메시지 포함)</li>
<li><strong><code>CACHE_INVALIDATED</code>:</strong> 캐시 무효화 알림 (관련 CVE ID 정보 포함 가능)</li>
<li><strong><code>ERROR</code>:</strong> 서버 측 소켓 오류 알림</li>
</ul>
<h3 id="53-주요-websocket-이벤트-client---server">5.3. 주요 WebSocket 이벤트 (Client -&gt; Server)</h3>
<ul>
<li><strong><code>connect</code>:</strong> 클라이언트 연결 시도 (인증 정보 포함 - <code>auth</code> 파라미터)</li>
<li><strong><code>disconnect</code>:</strong> 클라이언트 연결 해제</li>
<li><strong><code>subscribe_cve</code>:</strong> 특정 CVE 구독 요청 (<code>{ cve_id: &quot;...&quot; }</code>)</li>
<li><strong><code>unsubscribe_cve</code>:</strong> 특정 CVE 구독 해제 요청 (<code>{ cve_id: &quot;...&quot; }</code>)</li>
<li><strong><code>ping</code>:</strong> (클라이언트 구현 시) 서버 생존 확인</li>
</ul>
<h2 id="6-설정-및-배포-configuration--deployment">6. 설정 및 배포 (Configuration &amp; Deployment)</h2>
<ul>
<li><strong>설정:</strong> <code>app/core/config.py</code> 및 <code>.env</code> 파일을 통해 관리. DB 연결 정보, JWT 비밀키, CORS 설정, Redis URL 등이 주요 설정값.</li>
<li><strong>실행:</strong> Uvicorn과 같은 ASGI 서버 필요. (예: <code>uvicorn app.main:app --host 0.0.0.0 --port 8000</code>)</li>
<li><strong>배포:</strong> Dockerfile 및 docker-compose.yml을 사용하여 컨테이너화된 환경에 배포하는 것이 일반적. (제공된 소스에는 설정 파일 부재) MongoDB, Redis 인스턴스 별도 필요.</li>
</ul>
<h2 id="7-ai-agent-활용-가이드">7. AI Agent 활용 가이드</h2>
<p>이 문서는 AI Agent가 CVEHub 프로젝트를 이해하고 추가 개발/개선 작업을 수행하는 데 필요한 정보를 제공합니다.</p>
<ul>
<li><strong>기능 추가:</strong>
<ul>
<li>새로운 API 엔드포인트 추가 시: 관련 모듈(<code>cve</code>, <code>auth</code> 등)의 <code>router.py</code>, <code>service.py</code>, <code>repository.py</code>, <code>models.py</code> 파일을 수정/추가하고, <code>api.py</code>에 라우터를 등록합니다. Pydantic 스키마를 사용하여 요청/응답 형식을 명확히 정의합니다.</li>
<li>프론트엔드 UI 추가/수정 시: 해당 <code>features/**</code> 디렉토리 내 컴포넌트 수정, 필요시 React Query 훅 추가/수정.</li>
<li>실시간 기능 추가 시: 백엔드 <code>socketio/manager.py</code>, <code>service.py</code>에 이벤트 핸들러 및 발송 로직 추가. 프론트엔드 <code>useSocket</code> 훅 또는 관련 훅에서 이벤트 구독/처리 로직 추가.</li>
</ul>
</li>
<li><strong>버그 수정:</strong>
<ul>
<li>에러 로그(백엔드) 및 브라우저 콘솔 로그(프론트엔드) 확인.</li>
<li>관련 모듈의 서비스, 리포지토리, 라우터(백엔드) 또는 컴포넌트, 훅(프론트엔드) 코드 분석.</li>
<li>데이터 흐름 추적(API 호출, DB 쿼리, WebSocket 이벤트)을 통해 원인 파악.</li>
</ul>
</li>
<li><strong>개선 작업:</strong>
<ul>
<li>문서의 &quot;개선점 및 고려사항&quot; 섹션 참고.</li>
<li><strong>성능:</strong> DB 쿼리 최적화(인덱스 활용, 프로젝션), 캐싱 전략 개선, 비동기 처리(FastAPI, asyncio), 프론트엔드 번들 최적화, 코드 스플리팅.</li>
<li><strong>상태 관리:</strong> 프론트엔드 상태 관리 라이브러리 통합 검토.</li>
<li><strong>테스트:</strong> 유닛/통합 테스트 코드 작성 (pytest, testing-library 등).</li>
</ul>
</li>
<li><strong>주의사항:</strong>
<ul>
<li>프론트엔드(CamelCase)와 백엔드(Snake_case) 간 <strong>케이스 변환</strong> 로직(<code>axios.ts</code>, <code>caseConverter.ts</code>, 백엔드 Pydantic 설정)을 이해해야 합니다.</li>
<li><strong>의존성 주입</strong>(<code>core/dependencies.py</code>) 구조를 이해하고 서비스/리포지토리 사용 시 해당 함수를 통해 인스턴스를 가져와야 합니다.</li>
<li><strong>실시간 동기화</strong> 로직(WebSocket 이벤트, React Query 캐시 업데이트)을 고려하여 데이터 일관성을 유지해야 합니다.</li>
<li><strong>인증/인가</strong> 로직(<code>get_current_user</code>, <code>get_current_admin_user</code>)을 이해하고 API 접근 제어에 적용해야 합니다.</li>
</ul>
</li>
</ul>

            
            
        </body>
        </html>